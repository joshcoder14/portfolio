var stripe,setupElements=function(e){console.log("SetupData:",e);var t,i=stripe.elements().create("card",{hidePostalCode:!0,style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}});return i.mount("#stripe-input"),jQuery(".memberdeck form #stripe-input").show(),{card:i,clientSecret:e.client_secret}};jQuery(document).ready(function(){if(jQuery(".checkout-title-bar .currency-symbol sup").html(jQuery("#finaldescStripeCheckout").data("currency-symbol")),"preauth"==jQuery("#payment-form").data("txn-type")){var e=idcCheckoutCustomer(),t=idcCheckoutExtraFields(),i=parseFloat(jQuery('input[name="pwyw-price"]').val()),r=jQuery("#payment-form").data("txn-type"),a=jQuery("#payment-form").data("renewable"),s=jQuery("#stripe-input").data("customer-id"),o=jQuery("#finaldescStripeCheckout").data("post-id"),n=window.location.href,c="";jQuery.each(t.posts,function(){c=c+"&"+this.name+"="+this.value});var m={action:"id_stripe_checkout_submit",customer:e,Fields:t.posts,txnType:r,Renewable:a,post_id:o,customer_id:s,pwyw_price:i,current_url:n,anonymous_checkout:jQuery("#anonymous_checkout:checked").val(),idc_checkout_comments:jQuery("#idc_checkout_comments").val(),checkout_donation:jQuery("#checkout_donation").val(),cover_fees:jQuery("#cover_fees_on_checkout:checked").val()};jQuery.ajax({url:memberdeck_ajaxurl,type:"POST",data:m,success:function(e){var t=JSON.parse(e);if(void 0!==t.message.connected_account?(stripe=Stripe(stripecheckout_pk,{stripeAccount:t.message.connected_account}),console.log("Stripe Checkout Connect Loaded - IDStripecheckout")):(stripe=Stripe(stripecheckout_pk),console.log("Stripe Checkout Loaded - IDStripecheckout")),"failure"==t.response){jQuery("#id-main-submit").removeAttr("disabled").text("").removeClass("processing"),jQuery("#id-main-submit").text(idc_localization_strings.pay_with_stripe),jQuery(".payment-errors").text(t.message),setTimeout(function(){jQuery(".payment-errors").text("")},1e4);return}var i=setupElements(t.message);document.querySelector("#id-main-submit").addEventListener("click",function(e){e.preventDefault();var r={card:i.card};stripe.confirmCardPayment(t.message.client_secret,{payment_method:r}).then(function(e){e.error?(jQuery("#id-main-submit").removeAttr("disabled").text("").removeClass("processing"),jQuery("#id-main-submit").text(idc_localization_strings.pay_with_stripe),jQuery(".payment-errors").text(e.error.message),setTimeout(function(){jQuery(".payment-errors").text("")},1e4)):void 0!==t.message.connected_account?orderComplete(t.message.client_secret,t.message.connected_account):orderComplete(t.message.client_secret)})})},error:function(e){jQuery("#id-main-submit").removeAttr("disabled").text("").removeClass("processing"),jQuery("#id-main-submit").text(idc_localization_strings.pay_with_stripe),jQuery(".payment-errors").text(e)}})}}),jQuery(document).bind("idcCheckoutLoaded",function(e){var t=jQuery("#payment-form").data("type"),i=jQuery("#payment-form").data("txn-type");("recurring"==t||"preauth"==i)&&no_methods()}),jQuery(document).bind("idcPaySelect",function(e,t){"pay-with-stripe-checkout"==jQuery(t).attr("id")&&(jQuery("#id-main-submit").text(idc_localization_strings.pay_with_stripe).attr("name","submitPaymentStripeCheckout").removeAttr("disabled"),jQuery(".finaldesc").hide(),jQuery("#finaldescStripeCheckout").show())}),jQuery(document).bind("idcCheckoutSubmit",function(e,t){if("submitPaymentStripeCheckout"==t&&"preauth"!=jQuery("#payment-form").data("txn-type")){jQuery(".payment-errors").text("");var i=idcCheckoutCustomer(),r=idcCheckoutExtraFields(),a=parseFloat(jQuery('input[name="pwyw-price"]').val()),s=jQuery("#payment-form").data("txn-type"),o=jQuery("#payment-form").data("renewable"),n=jQuery("#stripe-input").data("customer-id"),c=jQuery("#finaldescStripeCheckout").data("post-id"),m=window.location.href,u="";jQuery.each(r.posts,function(){u=u+"&"+this.name+"="+this.value});var p={action:"id_stripe_checkout_submit",customer:i,Fields:r.posts,txnType:s,Renewable:o,post_id:c,customer_id:n,pwyw_price:a,current_url:m,anonymous_checkout:jQuery("#anonymous_checkout:checked").val(),idc_checkout_comments:jQuery("#idc_checkout_comments").val(),checkout_donation:jQuery("#checkout_donation").val(),cover_fees:jQuery("#cover_fees_on_checkout:checked").val()};jQuery.ajax({url:memberdeck_ajaxurl,type:"POST",data:p,success:function(e){if("string"==typeof e){var t=JSON.parse(e);void 0!==t.message.connected_account?(stripe=Stripe(stripecheckout_pk,{stripeAccount:t.message.connected_account}),console.log("Stripe Checkout Connect Loaded - IDStripecheckout")):(stripe=Stripe(stripecheckout_pk),console.log("Stripe Checkout Loaded - IDStripecheckout")),"success"==t.response?stripe.redirectToCheckout({sessionId:t.message.id}):(jQuery("#id-main-submit").removeAttr("disabled").text("").removeClass("processing"),jQuery("#id-main-submit").text(idc_localization_strings.pay_with_stripe),jQuery(".payment-errors").text(t.message))}},error:function(e){jQuery("#id-main-submit").removeAttr("disabled").text("").removeClass("processing"),jQuery("#id-main-submit").text(idc_localization_strings.pay_with_stripe),jQuery(".payment-errors").text(e)}})}});var orderComplete=function(e,t=""){stripe.retrievePaymentIntent(e).then(function(e){var i=e.paymentIntent;"requires_capture"==i.status&&jQuery.ajax({url:memberdeck_ajaxurl,type:"POST",data:{action:"id_stripe_checkout_paymentIntent",intent_id:i.id,connect_id:t},success:function(e){if("string"==typeof e){var t=JSON.parse(e);"success"==t.response?window.location.href=t.message:(jQuery("#id-main-submit").removeAttr("disabled").text("").removeClass("processing"),jQuery("#id-main-submit").text(idc_localization_strings.pay_with_stripe),jQuery(".payment-errors").text(t.message))}},error:function(e){jQuery("#id-main-submit").removeAttr("disabled").text("").removeClass("processing"),jQuery("#id-main-submit").text(idc_localization_strings.pay_with_stripe),jQuery(".payment-errors").text(e)}})})};